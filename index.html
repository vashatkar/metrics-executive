<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>People Metrics · Executive</title>
<link href="https://fonts.googleapis.com/css2?family=DM&#43;Sans:wght@400;500;600;700&amp;family=Fraunces:opsz,wght@9..144,400;9..144,600;9..144,700&amp;display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--navy:#0F1A2E;--navy-l:#1A2744;--teal:#0D7377;--teal-bg:#EEF7F7;--teal-b:#C8E6E6;--gold:#D4A017;--gold-bg:#FEF3C7;--gold-b:#FDE68A;--sand:#FAF8F5;--bg:#FAFAFA;--border:#E5E5E5;--t1:#0F1A2E;--t2:#374151;--t3:#6B7280;--t4:#A3A3A3;--white:#FFF;--green-bg:#DCFCE7;--green-fg:#166534;--amber-bg:#FEF3C7;--amber-fg:#92400E;--blue-bg:#DBEAFE;--blue-fg:#1E40AF;--red-bg:#FEE2E2;--red-fg:#991B1B}
body{font-family:'DM Sans',system-ui,sans-serif;background:var(--bg);color:var(--t2);line-height:1.5;overflow:hidden;height:100vh}
.shell{display:flex;height:100vh}
 
.sidebar{width:210px;background:var(--navy);display:flex;flex-direction:column;flex-shrink:0}
.sidebar-brand{padding:20px 16px;border-bottom:1px solid rgba(255,255,255,.08)}
.sidebar-brand h1{font-family:'Fraunces',Georgia,serif;font-size:16px;color:#FFF;font-weight:600}
.sidebar-brand p{font-size:10px;color:var(--gold);text-transform:uppercase;letter-spacing:1.5px;margin-top:2px}
.nav{padding:8px 0;flex:1}
.nav-item{display:flex;align-items:center;gap:8px;padding:11px 16px;font-size:13px;font-weight:500;color:#737373;cursor:pointer;border-left:3px solid transparent;transition:.15s}
.nav-item:hover{color:#CCC;background:rgba(255,255,255,.03)}
.nav-item.active{color:#FFF;background:var(--navy-l);border-left-color:var(--gold)}
.nav-icon{font-size:14px;width:18px;text-align:center}
.nav-ct{margin-left:auto;font-size:10px;background:rgba(255,255,255,.1);padding:1px 7px;border-radius:8px;font-weight:700}
.sidebar-foot{padding:14px 16px;font-size:10px;color:#525252;border-top:1px solid rgba(255,255,255,.08)}
 
.main{flex:1;display:flex;flex-direction:column;overflow:hidden}
 
.filter-bar{background:var(--white);border-bottom:1px solid var(--border);padding:10px 20px;display:flex;align-items:center;gap:10px;flex-shrink:0;flex-wrap:wrap}
.search-wrap{flex:1;max-width:280px;position:relative}
.search-wrap input{width:100%;padding:7px 12px 7px 32px;border-radius:8px;border:1px solid var(--border);font-size:13px;font-family:inherit;background:var(--bg);outline:none}
.search-wrap input:focus{border-color:var(--teal);box-shadow:0 0 0 3px rgba(13,115,119,.1)}
.search-icon{position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:14px;color:var(--t4)}
select{padding:6px 10px;border-radius:8px;border:1px solid var(--border);font-size:11px;font-family:inherit;background:var(--white);color:var(--t2);cursor:pointer;outline:none}
select:focus{border-color:var(--teal)}
 
.two-panel{flex:1;display:flex;overflow:hidden}
.metric-list{width:330px;border-right:1px solid var(--border);overflow-y:auto;background:var(--white);flex-shrink:0}
.list-header{padding:10px 16px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--t4);background:var(--bg);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:2}
.list-item{padding:12px 16px;border-bottom:1px solid #F5F5F5;cursor:pointer;border-right:3px solid transparent;transition:.1s}
.list-item:hover{background:#FAFAFA}
.list-item.active{background:var(--teal-bg);border-right-color:var(--gold)}
.list-item h3{font-size:14px;font-weight:600;color:var(--t1);margin-bottom:3px}
.list-item p{font-size:11px;color:var(--t4);margin-bottom:4px}
.detail-panel{flex:1;overflow-y:auto;padding:24px 28px}
.detail-empty{display:flex;align-items:center;justify-content:center;height:100%;flex-direction:column;color:var(--t4)}
.detail-empty span:first-child{font-size:32px;margin-bottom:8px;opacity:.3}
 
.badge{display:inline-block;padding:2px 10px;border-radius:4px;font-size:10px;font-weight:700;letter-spacing:.3px;text-transform:uppercase;white-space:nowrap}
.badge-sm{padding:1px 6px;font-size:9px}
.badge-exec{background:var(--gold-bg);color:var(--amber-fg)}
.badge-team{background:#F3F4F6;color:var(--t2)}
.badge-active{background:var(--green-bg);color:var(--green-fg)}
.badge-review{background:var(--amber-bg);color:var(--amber-fg)}
.badge-draft{background:var(--blue-bg);color:var(--blue-fg)}
.badge-domain{background:#F3F4F6;color:var(--t2)}
.badge-owner{background:#F3F4F6;color:var(--t3)}
 
.detail-head{margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid var(--border)}
.detail-head h2{font-family:'Fraunces',Georgia,serif;font-size:24px;font-weight:600;color:var(--t1);line-height:1.2;margin-bottom:8px}
.badges{display:flex;gap:6px;flex-wrap:wrap}
.sec{margin-bottom:16px}
.sec-title{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t4);margin-bottom:6px}
.info-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px}
.info-card{background:#F9FAFB;border-radius:8px;padding:10px 12px;border:1px solid #F3F4F6}
.info-card .label{font-size:10px;color:var(--t4);font-weight:600;text-transform:uppercase;letter-spacing:.3px;margin-bottom:2px}
.info-card .value{font-size:13px;font-weight:500;color:var(--t1);word-break:break-word}
.related-chip{padding:5px 12px;border-radius:6px;background:var(--teal-bg);color:var(--teal);font-size:12px;font-weight:600;cursor:pointer;border:1px solid var(--teal-b);display:inline-block;margin:0 4px 4px 0}
.related-chip:hover{background:#D5EDED}
.related-chip.disabled{opacity:.5;cursor:default}
.product-row{padding:8px 12px;background:#FAFAFA;border:1px solid var(--border);border-radius:6px;font-size:13px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;margin-bottom:4px}
.product-row:hover{background:#F5F5F5}
.change-item{padding:8px 0;border-bottom:1px solid #F3F4F6;font-size:13px}
 
.calendar-scroll{flex:1;overflow-y:auto;padding:24px 28px}
.freq-group{margin-bottom:28px}
.freq-header{display:flex;align-items:center;gap:8px;margin-bottom:12px;padding-bottom:6px;border-bottom:2px solid var(--gold-b)}
.freq-header .icon{font-size:16px;color:var(--gold)}
.freq-header h3{font-size:15px;font-weight:700;color:var(--t1)}
.freq-header span{font-size:11px;color:var(--t4);font-weight:500}
.cal-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:12px}
.cal-card{background:var(--white);border-radius:10px;padding:18px 20px;border:1px solid var(--border);transition:box-shadow .15s}
.cal-card.dash{border-left:4px solid var(--teal)}
.cal-card.anal{border-left:4px solid var(--gold)}
.cal-card h4{font-size:15px;font-weight:600;color:var(--t1);line-height:1.3}
.cal-meta{display:flex;gap:6px;align-items:center;margin:6px 0 8px;flex-wrap:wrap;font-size:11px}
.cal-meta .type{font-weight:700}
.cal-meta .dot{color:#D4D4D4}
.cal-poc{display:flex;gap:12px;margin-bottom:8px;font-size:12px}
.cal-poc strong{color:var(--t4);font-weight:600}
.month-pills{display:flex;flex-wrap:wrap;gap:3px;margin-bottom:8px}
.month-pill{font-size:10px;font-weight:700;padding:3px 6px;border-radius:4px;letter-spacing:.2px;min-width:28px;text-align:center}
.month-pill.active{background:var(--gold-bg);color:var(--amber-fg);border:1px solid var(--gold-b)}
.month-pill.next{background:var(--gold);color:#FFF;border:1px solid var(--gold)}
.month-pill.inactive{background:#F5F5F5;color:#D4D4D4;border:1px solid var(--border)}
.next-delivery{font-weight:700;color:var(--gold);background:#FFFBEB;padding:2px 8px;border-radius:4px;font-size:11px;display:inline-block;margin-bottom:8px}
.metric-chip{font-size:10px;padding:2px 8px;border-radius:4px;font-weight:600;cursor:pointer;display:inline-block;margin:0 3px 3px 0;border:1px solid}
.metric-chip.teal{background:var(--teal-bg);color:var(--teal);border-color:var(--teal-b)}
.metric-chip.gold{background:var(--gold-bg);color:var(--amber-fg);border-color:var(--gold-b)}
details>summary{list-style:none;cursor:pointer;user-select:none}
details>summary::-webkit-details-marker{display:none}
.link-arrow{font-size:11px;color:var(--teal);text-decoration:none;font-weight:600}
.link-arrow.gold{color:var(--gold)}
.section-head{display:flex;align-items:baseline;gap:10px;margin-bottom:12px}
.section-head h2{font-family:'Fraunces',Georgia,serif;font-size:20px;font-weight:600;color:var(--t1)}
.section-head p{font-size:12px;color:var(--t4)}
 
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#D4D4D4;border-radius:3px}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.fade-in{animation:fadeIn .2s ease}
</style>
</head>
<body>
<div class="shell">

<div class="sidebar">
<div class="sidebar-brand"><h1>People Metrics</h1><p>Executive View</p></div>
<nav class="nav" id="nav"></nav>
<div class="sidebar-foot">Generated from Google Sheets<br>Last updated Feb 2026</div>
</div>
<div class="main" id="main"></div>
</div>

<script>




const SITE_DATA = {"METRICS": [{"id": "PSA-001", "name": "Total Headcount", "domain": "Workforce Planning", "owner": "PSA", "status": "Active", "tier": "Executive", "def": "Total active employees (FTE+PTE) on payroll. Excludes contractors, interns, unpaid leave >90d.", "refresh": "Daily", "range": "2,800–3,400", "related": ["Voluntary Attrition Rate", "Span of Control"], "changes": [{"id": "CHG-003", "status": "Implemented", "type": "SQL Change", "desc": "Unpaid leave >90d exclusion.", "by": "PSA", "date": "2026-01-10"}]}, {"id": "PSA-002", "name": "Voluntary Attrition Rate", "domain": "Talent Retention", "owner": "PSA", "status": "Active", "tier": "Executive", "def": "% voluntary separations / avg HC, annualized.", "refresh": "Monthly", "range": "8%–15%", "related": ["Involuntary Attrition Rate", "Total Attrition Rate", "90-Day New Hire Retention"], "changes": [{"id": "CHG-001", "status": "Proposed", "type": "Definition Change", "desc": "Include retirement as voluntary. SHRM alignment.", "by": "Maria S.", "date": "2026-02-15"}]}, {"id": "PSA-003", "name": "Involuntary Attrition Rate", "domain": "Talent Retention", "owner": "PSA", "status": "Active", "tier": "Executive", "def": "% involuntary separations / avg HC, annualized.", "refresh": "Monthly", "range": "2%–5%", "related": ["Voluntary Attrition Rate", "Total Attrition Rate"], "changes": []}, {"id": "PSA-004", "name": "Total Attrition Rate", "domain": "Talent Retention", "owner": "PSA", "status": "Active", "tier": "Executive", "def": "Combined vol+invol rate, annualized.", "refresh": "Monthly", "range": "12%–20%", "related": ["Voluntary Attrition Rate", "Involuntary Attrition Rate"], "changes": []}, {"id": "TAA-001", "name": "Time to Fill", "domain": "Talent Acquisition", "owner": "TA Analytics", "status": "Active", "tier": "Executive", "def": "Avg days from req approval to offer acceptance.", "refresh": "Weekly", "range": "25–55 days", "related": ["Time to Start", "Cost Per Hire", "Offer Acceptance Rate"], "changes": []}, {"id": "TAA-003", "name": "Cost Per Hire", "domain": "Talent Acquisition", "owner": "TA Analytics", "status": "Under Review", "tier": "Executive", "def": "Total costs / hires. SHRM/ANSI.", "refresh": "Monthly", "range": "$3,500–$7,500", "related": ["Time to Fill", "Offer Acceptance Rate"], "changes": [{"id": "CHG-002", "status": "Proposed", "type": "SQL Change", "desc": "Add relocation costs.", "by": "James K.", "date": "2026-02-10"}]}, {"id": "ENG-001", "name": "Employee Net Promoter Score (eNPS)", "domain": "Employee Engagement", "owner": "People Analytics", "status": "Active", "tier": "Executive", "def": "Promoters% minus Detractors%.", "refresh": "Quarterly", "range": "+15 to +45", "related": ["Survey Response Rate"], "changes": []}, {"id": "PSA-005", "name": "Span of Control", "domain": "Organizational Design", "owner": "PSA", "status": "Active", "tier": "Executive", "def": "Avg direct reports per manager.", "refresh": "Monthly", "range": "5–9", "related": ["Total Headcount", "Manager to IC Ratio"], "changes": []}, {"id": "PSA-006", "name": "Manager to IC Ratio", "domain": "Organizational Design", "owner": "PSA", "status": "Active", "tier": "Executive", "def": "Ratio managers to ICs (1:N).", "refresh": "Monthly", "range": "1:6–1:10", "related": ["Span of Control", "Total Headcount"], "changes": []}, {"id": "TAA-005", "name": "90-Day New Hire Retention", "domain": "Talent Acquisition", "owner": "TA Analytics", "status": "Active", "tier": "Executive", "def": "% new hires still employed at 90d.", "refresh": "Monthly", "range": "88%–96%", "related": ["Voluntary Attrition Rate", "Time to Fill", "Cost Per Hire"], "changes": []}, {"id": "TR-001", "name": "Compensation Ratio (Compa-Ratio)", "domain": "Total Rewards", "owner": "Compensation Team", "status": "Active", "tier": "Executive", "def": "Base / band midpoint.", "refresh": "Monthly", "range": "92%–108%", "related": ["Gender Pay Equity Ratio", "Diversity Representation"], "changes": []}, {"id": "DEI-001", "name": "Gender Pay Equity Ratio", "domain": "DEI", "owner": "DEI Analytics", "status": "Active", "tier": "Executive", "def": "Median comp ratio W/M by level+function.", "refresh": "Quarterly", "range": "0.97–1.03", "related": ["Compensation Ratio (Compa-Ratio)", "Diversity Representation"], "changes": []}, {"id": "DEI-002", "name": "Diversity Representation", "domain": "DEI", "owner": "DEI Analytics", "status": "Active", "tier": "Executive", "def": "% URM by level tier.", "refresh": "Quarterly", "range": "Varies", "related": ["Gender Pay Equity Ratio"], "changes": []}, {"id": "PSA-007", "name": "Internal Mobility Rate", "domain": "Career Development", "owner": "People Analytics", "status": "Active", "tier": "Executive", "def": "% positions filled internally.", "refresh": "Quarterly", "range": "20%–40%", "related": ["Time to Fill", "Promotion Rate"], "changes": []}, {"id": "PSA-008", "name": "Promotion Rate", "domain": "Career Development", "owner": "People Analytics", "status": "Active", "tier": "Executive", "def": "% promoted (level increase), annualized.", "refresh": "Semi-annually", "range": "8%–18%", "related": ["Internal Mobility Rate", "Diversity Representation"], "changes": []}], "DASHBOARDS": [{"id": "PRD-001", "name": "Board People Dashboard", "type": "Tableau", "metrics": ["Total Headcount", "Voluntary Attrition Rate", "Total Attrition Rate", "Employee Net Promoter Score (eNPS)", "Gender Pay Equity Ratio", "Diversity Representation"], "link": "https://tableau.company.com/views/board-people", "owner": "CHRO Office", "team": "Executive", "severity": "High", "tier": "Executive", "desc": "", "refresh": "", "audience": "CHRO Office", "poc": "CHRO Office", "status": "Active", "tables": []}, {"id": "PRD-002", "name": "Board DEI Dashboard", "type": "Tableau", "metrics": ["Gender Pay Equity Ratio", "Diversity Representation", "Promotion Rate"], "link": "https://tableau.company.com/views/board-dei", "owner": "CHRO Office", "team": "Executive", "severity": "High", "tier": "Executive", "desc": "", "refresh": "", "audience": "CHRO Office", "poc": "CHRO Office", "status": "Active", "tables": []}, {"id": "PRD-008", "name": "CHRO Monthly Report", "type": "Other", "metrics": ["Total Headcount", "Voluntary Attrition Rate", "Involuntary Attrition Rate", "Total Attrition Rate", "Time to Fill", "Cost Per Hire", "Employee Net Promoter Score (eNPS)", "Compensation Ratio (Compa-Ratio)", "Gender Pay Equity Ratio", "Diversity Representation"], "link": "", "owner": "PSA", "team": "Executive", "severity": "High", "tier": "Executive", "desc": "", "refresh": "", "audience": "PSA", "poc": "PSA", "status": "Active", "tables": []}, {"id": "PRD-009", "name": "Quarterly Business Review", "type": "Other", "metrics": ["Total Headcount", "Voluntary Attrition Rate", "Total Attrition Rate", "Cost Per Hire", "Employee Net Promoter Score (eNPS)", "Gender Pay Equity Ratio", "Diversity Representation"], "link": "", "owner": "PSA", "team": "Executive", "severity": "High", "tier": "Executive", "desc": "", "refresh": "", "audience": "PSA", "poc": "PSA", "status": "Active", "tables": []}], "ANALYSES": [{"id": "DEL-001", "name": "Board People Dashboard", "type": "Tableau", "freq": "Monthly", "recurrence": "3rd business day", "audience": "Board, CHRO", "tier": "Executive", "metrics": ["Total Headcount", "Voluntary Attrition Rate", "Total Attrition Rate", "Employee Net Promoter Score (eNPS)", "Gender Pay Equity Ratio", "Diversity Representation"], "link": "https://tableau.company.com/views/board-people", "poc": "PSA", "team": "PSA", "status": "Active", "months": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"], "desc": "", "leadTime": "", "lastDelivered": "", "tables": []}, {"id": "DEL-002", "name": "Board DEI Dashboard", "type": "Tableau", "freq": "Quarterly", "recurrence": "Q+10 business days", "audience": "Board, CHRO, DEI Committee", "tier": "Executive", "metrics": ["Gender Pay Equity Ratio", "Diversity Representation", "Promotion Rate"], "link": "https://tableau.company.com/views/board-dei", "poc": "DEI Analytics", "team": "DEI Analytics", "status": "Active", "months": ["Mar", "Jun", "Sep", "Dec"], "desc": "", "leadTime": "", "lastDelivered": "", "tables": []}, {"id": "DEL-003", "name": "CHRO Monthly Report", "type": "Other", "freq": "Monthly", "recurrence": "5th business day", "audience": "CHRO, VP HR, HR Leadership", "tier": "Executive", "metrics": ["Total Headcount", "Voluntary Attrition Rate", "Involuntary Attrition Rate", "Total Attrition Rate", "Time to Fill", "Cost Per Hire", "Employee Net Promoter Score (eNPS)", "Compensation Ratio (Compa-Ratio)", "Gender Pay Equity Ratio", "Diversity Representation"], "link": "(manual)", "poc": "PSA", "team": "PSA", "status": "Active", "months": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"], "desc": "", "leadTime": "", "lastDelivered": "", "tables": []}, {"id": "DEL-004", "name": "Executive TA Review", "type": "Other", "freq": "Monthly", "recurrence": "7th business day", "audience": "CHRO, VP TA, Hiring Committee", "tier": "Executive", "metrics": ["Time to Fill", "Time to Start", "Cost Per Hire", "Offer Acceptance Rate", "90-Day New Hire Retention", "Internal Mobility Rate"], "link": "(manual)", "poc": "TA Analytics", "team": "TA Analytics", "status": "Active", "months": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"], "desc": "", "leadTime": "", "lastDelivered": "", "tables": []}, {"id": "DEL-005", "name": "QBR People Section", "type": "Other", "freq": "Quarterly", "recurrence": "Q+15 business days", "audience": "CEO, CFO, CHRO, BU Heads", "tier": "Executive", "metrics": ["Total Headcount", "Voluntary Attrition Rate", "Total Attrition Rate", "Cost Per Hire", "Employee Net Promoter Score (eNPS)", "Gender Pay Equity Ratio", "Diversity Representation"], "link": "(manual)", "poc": "PSA", "team": "PSA", "status": "Active", "months": ["Jan", "Apr", "Jul", "Oct"], "desc": "", "leadTime": "", "lastDelivered": "", "tables": []}, {"id": "DEL-009", "name": "Annual DEI Report", "type": "PDF", "freq": "Annually", "recurrence": "March 15", "audience": "All Employees (public)", "tier": "Executive", "metrics": ["Gender Pay Equity Ratio", "Diversity Representation", "Internal Mobility Rate", "Promotion Rate"], "link": "(manual)", "poc": "DEI Lead", "team": "DEI Lead", "status": "Active", "months": ["Mar"], "desc": "", "leadTime": "", "lastDelivered": "", "tables": []}]}; 
const METRICS = SITE_DATA.METRICS || [];
const DASHBOARDS = SITE_DATA.DASHBOARDS || [];
const ANALYSES = SITE_DATA.ANALYSES || [];




const ALL_MONTHS=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
const CUR_MO=new Date().getMonth();
const typeColor={Tableau:"#E04D01",Looker:"#1A73E8",PowerPoint:"#C43E1C",Excel:"#217346",PDF:"#B7222F",Other:"#6B7280"};

function nextDel(months){
  if(!months||!months.length)return"—";
  const idxs=months.map(m=>ALL_MONTHS.indexOf(m)).filter(i=>i>=0).sort((a,b)=>a-b);
  for(const i of idxs){if(i>=CUR_MO)return ALL_MONTHS[i]}
  return ALL_MONTHS[idxs[0]];
}
function freqLabel(months){
  const n=months.length;
  if(n===12)return"Monthly";if(n===4)return"Quarterly";if(n===2)return"Semi-annually";if(n===1)return"Annually";return n+"x/year";
}
function statusClass(s){return s==="Active"?"badge-active":s==="Under Review"?"badge-review":s==="Draft"?"badge-draft":"badge-domain"}
function esc(s){const d=document.createElement("div");d.textContent=s;return d.innerHTML}

let currentPage="metrics", selectedMetric=null;




function renderNav(){
  const items=[
    {key:"metrics",icon:"◈",label:"Metrics",ct:METRICS.length},
    {key:"calendar",icon:"◫",label:"Calendar",ct:DASHBOARDS.length+ANALYSES.length}
  ];
  document.getElementById("nav").innerHTML=items.map(n=>`
    <div class="nav-item ${currentPage===n.key?"active":""}" onclick="goPage('${n.key}')">
      <span class="nav-icon">${n.icon}</span>${n.label}<span class="nav-ct">${n.ct}</span>
    </div>`).join("");
}

function goPage(p){currentPage=p;selectedMetric=null;renderNav();renderMain()}

// ══════════════════════════════════════════════


let mSearch="",mDomain="",mTier="",mStatus="",mOwner="";

function filterMetrics(){
  return METRICS.filter(m=>{
    const s=mSearch.toLowerCase();
    if(s&&!(m.name+m.id+m.domain+m.owner).toLowerCase().includes(s))return false;
    if(mDomain&&m.domain!==mDomain)return false;
    if(mStatus&&m.status!==mStatus)return false;
    if(mOwner&&m.owner!==mOwner)return false;
    return true;
  });
}

function renderMetricsPage(){
  const domains=[...new Set(METRICS.map(m=>m.domain))].sort();
  const owners=[...new Set(METRICS.map(m=>m.owner))].sort();
  const filtered=filterMetrics();

  let html=`
  <div class="filter-bar">
    <div class="search-wrap"><span class="search-icon">⌕</span><input id="mSearch" value="${esc(mSearch)}" placeholder="Search metrics..." oninput="mSearch=this.value;renderMetricsList()"></div>
    <select id="mDomain" onchange="mDomain=this.value;renderMetricsList()"><option value="">All Domains</option>${domains.map(d=>`<option${mDomain===d?" selected":""}>${esc(d)}</option>`).join("")}</select>
    <select id="mStatus" onchange="mStatus=this.value;renderMetricsList()"><option value="">All Statuses</option><option${mStatus==="Active"?" selected":""}>Active</option><option${mStatus==="Under Review"?" selected":""}>Under Review</option><option${mStatus==="Draft"?" selected":""}>Draft</option></select>
    <select id="mOwner" onchange="mOwner=this.value;renderMetricsList()"><option value="">All Owners</option>${owners.map(o=>`<option${mOwner===o?" selected":""}>${esc(o)}</option>`).join("")}</select>
  </div>
  <div class="two-panel">
    <div class="metric-list" id="metricList"></div>
    <div class="detail-panel" id="detailPanel"></div>
  </div>`;
  document.getElementById("main").innerHTML=html;
  renderMetricsList();
}

function renderMetricsList(){
  const filtered=filterMetrics();
  const list=document.getElementById("metricList");
  list.innerHTML=`<div class="list-header">${filtered.length} metrics</div>`+filtered.map(m=>`
    <div class="list-item ${selectedMetric===m.id?"active":""}" onclick="selectMetric('${m.id}')">
      <h3>${esc(m.name)}</h3>
      <p>${esc(m.domain)} · ${esc(m.owner)}</p>
      <div class="badges">
        <span class="badge badge-sm badge-exec">Executive</span>
        <span class="badge badge-sm ${statusClass(m.status)}">${esc(m.status)}</span>
      </div>
    </div>`).join("");
  renderDetail();
}

function selectMetric(id){selectedMetric=id;renderMetricsList()}

function renderDetail(){
  const panel=document.getElementById("detailPanel");
  if(!selectedMetric){panel.innerHTML=`<div class="detail-empty"><span>◈</span><span style="font-size:14px">Select a metric to view details</span></div>`;return}
  const m=METRICS.find(x=>x.id===selectedMetric);
  if(!m)return;

  const products=[
    ...DASHBOARDS.filter(d=>(d.metrics||[]).includes(m.name)).map(d=>({...d,kind:"Dashboard"})),
    ...ANALYSES.filter(a=>(a.metrics||[]).includes(m.name)).map(a=>({...a,kind:"Analysis"}))
  ];

  panel.innerHTML=`<div class="fade-in">
    <div class="detail-head">
      <h2>${esc(m.name)}</h2>
      <div class="badges">
        <span class="badge badge-exec">Executive</span>
        <span class="badge ${statusClass(m.status)}">${esc(m.status)}</span>
        <span class="badge badge-domain">${esc(m.domain)}</span>
        <span class="badge badge-owner">${esc(m.owner)}</span>
      </div>
    </div>
    <div class="sec"><div class="sec-title">Definition</div><p style="font-size:14px;color:var(--t2);line-height:1.7">${esc(m.def)}</p></div>
    <div class="info-grid">
      <div class="info-card"><div class="label">Refresh</div><div class="value">${esc(m.refresh)}</div></div>
      ${m.range?`<div class="info-card"><div class="label">Acceptable Range</div><div class="value">${esc(m.range)}</div></div>`:""}
      <div class="info-card"><div class="label">Owner</div><div class="value">${esc(m.owner)}</div></div>
    </div>
    <div class="sec"><div class="sec-title">Related Metrics</div><div>${m.related.map(r=>{
      const f=METRICS.find(x=>x.name===r);
      return `<span class="related-chip${f?"":" disabled"}" ${f?`onclick="selectMetric('${f.id}');renderMetricsList()"`:""}>${esc(r)}${f?" →":""}</span>`;
    }).join("")}</div></div>
    <div class="sec"><div class="sec-title">Used In</div>${products.length?products.map(p=>`
      <div class="product-row" onclick="goPage('calendar')">
        <div><span style="font-weight:500;color:var(--t1)">${esc(p.name)}</span></div>
        <div style="display:flex;gap:6px;align-items:center">
          <span class="badge badge-sm" style="background:${p.kind==="Dashboard"?"var(--teal-bg)":"var(--gold-bg)"};color:${p.kind==="Dashboard"?"var(--teal)":"var(--amber-fg)"}">${p.kind}</span>
          <span style="font-size:11px;font-weight:700;color:${typeColor[p.type]||"#6B7280"}">${esc(p.type)}</span>
        </div>
      </div>`).join(""):`<span style="font-size:13px;color:var(--t4)">No downstream products</span>`}</div>
    ${(m.changes||[]).length?`<div class="sec"><div class="sec-title">Change History</div>${m.changes.map(c=>`
      <div class="change-item">
        <div style="display:flex;gap:6px;align-items:center;margin-bottom:2px">
          <span class="badge badge-sm ${c.status==="Proposed"?"badge-review":c.status==="Implemented"?"badge-active":"badge-domain"}">${esc(c.status)}</span>
          <span style="color:var(--t3);font-size:12px">${esc(c.type)}</span>
        </div>
        <div style="color:var(--t2)">${esc(c.desc)}</div>
        <div style="font-size:11px;color:var(--t4);margin-top:2px">${esc(c.date)}</div>
      </div>`).join("")}</div>`:""}
  </div>`;
}

// ══════════════════════════════════════════════


let cSearch="",cType="",cTeam="",cFreq="";

function renderCalendarPage(){
  const types=[...new Set([...DASHBOARDS,...ANALYSES].map(d=>d.type))].sort();
  const teams=[...new Set([...DASHBOARDS,...ANALYSES].map(d=>d.team))].sort();

  let html=`
  <div class="filter-bar">
    <div class="search-wrap"><span class="search-icon">⌕</span><input id="cSearch" value="${esc(cSearch)}" placeholder="Search products, POC, team..." oninput="cSearch=this.value;renderCalContent()"></div>
    <select onchange="cType=this.value;renderCalContent()"><option value="">All Types</option>${types.map(t=>`<option${cType===t?" selected":""}>${esc(t)}</option>`).join("")}</select>
    <select onchange="cTeam=this.value;renderCalContent()"><option value="">All Teams</option>${teams.map(t=>`<option${cTeam===t?" selected":""}>${esc(t)}</option>`).join("")}</select>
    <select onchange="cFreq=this.value;renderCalContent()"><option value="">All Frequencies</option><option${cFreq==="Monthly"?" selected":""}>Monthly</option><option${cFreq==="Quarterly"?" selected":""}>Quarterly</option><option${cFreq==="Annually"?" selected":""}>Annually</option></select>
  </div>
  <div class="calendar-scroll" id="calContent"></div>`;
  document.getElementById("main").innerHTML=html;
  renderCalContent();
}

function filterCal(list){
  return list.filter(d=>{
    const s=cSearch.toLowerCase();
    if(s&&!(d.name+d.poc+d.team+(d.desc||"")).toLowerCase().includes(s))return false;
    if(cType&&d.type!==cType)return false;
    if(cTeam&&d.team!==cTeam)return false;
    if(cFreq){var mo=d.months||[];if(mo.length>0){if(freqLabel(mo)!==cFreq)return false}else{if((d.refresh||"")!==cFreq)return false}}
    return true;
  });
}

function renderCalContent(){
  const fDash=filterCal(DASHBOARDS);
  const fAnal=filterCal(ANALYSES);
  const el=document.getElementById("calContent");

  // Dashboards section
  let h=`<div class="section-head"><h2>Dashboards</h2><p>Always-on · auto-refresh</p></div>`;
  if(!fDash.length)h+=`<p style="font-size:13px;color:var(--t4);margin-bottom:24px">No dashboards match your filters</p>`;
  else{
    h+=`<div class="cal-grid" style="margin-bottom:32px">`;
    fDash.forEach(d=>{
      h+=`<div class="cal-card dash">
        <div style="display:flex;justify-content:space-between;align-items:flex-start"><h4>${esc(d.name)}</h4><span class="badge badge-exec">Executive</span></div>
        <div class="cal-meta"><span class="type" style="color:${typeColor[d.type]||"#6B7280"}">${esc(d.type)}</span><span class="dot">·</span><span style="color:var(--t3);background:#F5F5F5;padding:1px 6px;border-radius:3px">${esc(d.refresh)} refresh</span>${d.link?`<a href="${esc(d.link)}" target="_blank" class="link-arrow" style="margin-left:auto">Open →</a>`:""}</div>
        <div class="cal-poc"><span><strong>POC</strong> ${esc(d.poc)}</span><span><strong>Team</strong> ${esc(d.team)}</span></div>
        <div style="display:flex;flex-wrap:wrap;gap:4px">${(d.metrics||[]).map(mn=>`<span class="metric-chip teal" onclick="goMetric('${esc(mn)}')">${esc(mn)}</span>`).join("")}</div>
      </div>`;
    });
    h+=`</div>`;
  }

  // Recurring Analyses grouped by frequency
  h+=`<div class="section-head"><h2>Recurring Analyses</h2><p>Grouped by cadence · next delivery highlighted</p></div>`;
  if(!fAnal.length)h+=`<p style="font-size:13px;color:var(--t4)">No analyses match your filters</p>`;

  const freqOrder=["Monthly","Quarterly","Semi-annually","Annually","Other"];
  const freqIcons={Monthly:"⟳",Quarterly:"◧","Semi-annually":"◨",Annually:"◉",Other:"◇"};
  freqOrder.forEach(fg=>{
    const group=fAnal.filter(a=>{var mo=a.months||[];return mo.length>0&&freqLabel(mo)===fg});
    if(!group.length)return;
    h+=`<div class="freq-group"><div class="freq-header"><span class="icon">${freqIcons[fg]}</span><h3>${fg}</h3><span>(${group.length} deliverable${group.length>1?"s":""})</span></div><div class="cal-grid">`;
    group.forEach(a=>{
      var mo=a.months||[];var nx=nextDel(mo);
      h+=`<div class="cal-card anal">
        <div style="display:flex;justify-content:space-between;align-items:flex-start"><h4>${esc(a.name)}</h4><span class="badge badge-exec">Executive</span></div>
        <div class="cal-meta"><span class="type" style="color:${typeColor[a.type]||"#6B7280"}">${esc(a.type)}</span><span class="dot">·</span><span style="color:var(--t3)">${esc(a.audience)}</span>${a.link&&a.link!=="(manual)"?`<a href="${esc(a.link)}" target="_blank" class="link-arrow gold" style="margin-left:auto">Open →</a>`:""}</div>
        <div class="cal-poc"><span><strong>POC</strong> ${esc(a.poc)}</span><span><strong>Team</strong> ${esc(a.team)}</span></div>
        <div class="month-pills">${ALL_MONTHS.map(mo=>{const active=(a.months||[]).includes(mo);const isNx=mo===nx;return`<span class="month-pill ${isNx?"next":active?"active":"inactive"}">${mo}</span>`}).join("")}</div>
        <div><span class="next-delivery">Next delivery → ${nx}</span></div>
        <details><summary style="font-size:11px;color:var(--teal);font-weight:600">Metrics included (${(a.metrics||[]).length})</summary><div style="display:flex;flex-wrap:wrap;gap:4px;margin-top:6px">${(a.metrics||[]).map(mn=>`<span class="metric-chip gold" onclick="goMetric('${esc(mn)}')">${esc(mn)}</span>`).join("")}</div></details>
      </div>`;
    });
    h+=`</div></div>`;
  });

  el.innerHTML=h;
}

function goMetric(name){
  const f=METRICS.find(x=>x.name===name);
  if(f){currentPage="metrics";selectedMetric=f.id;renderNav();renderMain()}
}




function renderMain(){
  if(currentPage==="metrics")renderMetricsPage();
  else if(currentPage==="calendar")renderCalendarPage();
}

renderNav();renderMain();
</script>
</body>
</html>